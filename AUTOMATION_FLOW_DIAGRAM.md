# ğŸ”„ Automation Flow Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    USER DASHBOARD                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Budget     â”‚  â”‚    Rules     â”‚  â”‚   Logs &     â”‚     â”‚
â”‚  â”‚  Controls    â”‚  â”‚ Configurationâ”‚  â”‚  History     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AUTOMATION ENGINE (Backend)                     â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           RULE EVALUATOR (Every 5 min)            â”‚    â”‚
â”‚  â”‚  â€¢ Check position status                           â”‚    â”‚
â”‚  â”‚  â€¢ Evaluate fee claims                             â”‚    â”‚
â”‚  â”‚  â€¢ Detect out-of-range positions                   â”‚    â”‚
â”‚  â”‚  â€¢ Check for new position opportunities            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                   â”‚
â”‚                          â–¼                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           SAFETY CHECKS                            â”‚    â”‚
â”‚  â”‚  âœ“ Budget available?                               â”‚    â”‚
â”‚  â”‚  âœ“ Daily limit OK?                                 â”‚    â”‚
â”‚  â”‚  âœ“ Position limits OK?                             â”‚    â”‚
â”‚  â”‚  âœ“ Cooldown period passed?                         â”‚    â”‚
â”‚  â”‚  âœ“ Circuit breakers OK?                            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                                   â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                            â”‚
â”‚                    â”‚           â”‚                             â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚              â”‚  APPROVAL â”‚ â”‚  EXECUTE â”‚                     â”‚
â”‚              â”‚  REQUIRED â”‚ â”‚  DIRECTLYâ”‚                     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              TRANSACTION EXECUTOR                            â”‚
â”‚  â€¢ Build transaction (Meteora SDK)                            â”‚
â”‚  â€¢ Request wallet signature                                 â”‚
â”‚  â€¢ Send to Solana network                                   â”‚
â”‚  â€¢ Wait for confirmation                                    â”‚
â”‚  â€¢ Update database                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (Supabase)                              â”‚
â”‚  â€¢ automation_configs (settings)                            â”‚
â”‚  â€¢ automation_logs (execution history)                      â”‚
â”‚  â€¢ automation_approvals (pending actions)                    â”‚
â”‚  â€¢ position_transactions (tracking)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Decision Flow: Fee Claiming

```
START: Check every 5 minutes
  â”‚
  â”œâ”€â–º Position has fees?
  â”‚   â”‚
  â”‚   â”œâ”€ NO â”€â”€â–º Skip (wait next cycle)
  â”‚   â”‚
  â”‚   â””â”€ YES â”€â”€â–º Fees >= $5?
  â”‚       â”‚
  â”‚       â”œâ”€ NO â”€â”€â–º Skip (wait for threshold)
  â”‚       â”‚
  â”‚       â””â”€ YES â”€â”€â–º Last claim >= 24h ago?
  â”‚           â”‚
  â”‚           â”œâ”€ NO â”€â”€â–º Skip (cooldown active)
  â”‚           â”‚
  â”‚           â””â”€ YES â”€â”€â–º Budget allows gas fee?
  â”‚               â”‚
  â”‚               â”œâ”€ NO â”€â”€â–º Pause automation
  â”‚               â”‚
  â”‚               â””â”€ YES â”€â”€â–º Execute claim
  â”‚                   â”‚
  â”‚                   â”œâ”€ Success â”€â”€â–º Update budget, log, notify
  â”‚                   â”‚
  â”‚                   â””â”€ Failure â”€â”€â–º Log error, notify, retry?
  â”‚
END
```

---

## Decision Flow: Rebalancing

```
START: Position detected out of range
  â”‚
  â”œâ”€â–º Position out of range > 2 hours?
  â”‚   â”‚
  â”‚   â”œâ”€ NO â”€â”€â–º Skip (wait longer)
  â”‚   â”‚
  â”‚   â””â”€ YES â”€â”€â–º Last rebalance >= 6h ago?
  â”‚       â”‚
  â”‚       â”œâ”€ NO â”€â”€â–º Skip (cooldown active)
  â”‚       â”‚
  â”‚       â””â”€ YES â”€â”€â–º Position value > $10?
  â”‚           â”‚
  â”‚           â”œâ”€ NO â”€â”€â–º Skip (not worth it)
  â”‚           â”‚
  â”‚           â””â”€ YES â”€â”€â–º Budget allows new position?
  â”‚               â”‚
  â”‚               â”œâ”€ NO â”€â”€â–º Skip (insufficient funds)
  â”‚               â”‚
  â”‚               â””â”€ YES â”€â”€â–º Cost > approval threshold?
  â”‚                   â”‚
  â”‚                   â”œâ”€ YES â”€â”€â–º Create approval request
  â”‚                   â”‚         â”‚
  â”‚                   â”‚         â””â”€â–º User approves?
  â”‚                   â”‚             â”‚
  â”‚                   â”‚             â”œâ”€ NO â”€â”€â–º Skip
  â”‚                   â”‚             â”‚
  â”‚                   â”‚             â””â”€ YES â”€â”€â–º Execute
  â”‚                   â”‚
  â”‚                   â””â”€ NO â”€â”€â–º Execute directly
  â”‚                       â”‚
  â”‚                       â”œâ”€â–º Close old position
  â”‚                       â”‚   â”‚
  â”‚                       â”‚   â””â”€â–º Wait for confirmation
  â”‚                       â”‚
  â”‚                       â”œâ”€â–º Open new position
  â”‚                       â”‚   â”‚
  â”‚                       â”‚   â””â”€â–º Wait for confirmation
  â”‚                       â”‚
  â”‚                       â””â”€â–º Update budget, log, notify
  â”‚
END
```

---

## Budget Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Total Budget   â”‚  $1,000
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚   Spent      â”‚  $450
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚   Reserved   â”‚  $100 (pending approvals)
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   Available  â”‚  $450
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Action Request: $200
  â”‚
  â”œâ”€â–º Available ($450) >= Request ($200)?
  â”‚   â”‚
  â”‚   â”œâ”€ NO â”€â”€â–º âŒ REJECT: Insufficient budget
  â”‚   â”‚
  â”‚   â””â”€ YES â”€â”€â–º Daily spend + Request <= Daily limit?
  â”‚       â”‚
  â”‚       â”œâ”€ NO â”€â”€â–º âŒ REJECT: Daily limit exceeded
  â”‚       â”‚
  â”‚       â””â”€ YES â”€â”€â–º âœ… APPROVE: Execute action
  â”‚           â”‚
  â”‚           â””â”€â–º Update: Spent += $200
```

---

## Approval Workflow

```
Action Triggered (Cost > $100)
  â”‚
  â”œâ”€â–º Create approval record
  â”‚   â”‚
  â”‚   â”œâ”€â–º Status: 'pending'
  â”‚   â”œâ”€â–º Expires: 24h
  â”‚   â””â”€â–º Notify user
  â”‚
  â”œâ”€â–º User receives notification
  â”‚   â”‚
  â”‚   â”œâ”€â–º Review details
  â”‚   â”‚   â€¢ Action type
  â”‚   â”‚   â€¢ Cost
  â”‚   â”‚   â€¢ Position info
  â”‚   â”‚
  â”‚   â”œâ”€â–º Approve â”€â”€â–º Execute action
  â”‚   â”‚
  â”‚   â”œâ”€â–º Reject â”€â”€â–º Cancel, log rejection
  â”‚   â”‚
  â”‚   â””â”€â–º Expire (24h) â”€â”€â–º Auto-cancel
  â”‚
END
```

---

## Error Handling Flow

```
Transaction Execution
  â”‚
  â”œâ”€â–º Success â”€â”€â–º Update database, notify user
  â”‚
  â””â”€â–º Failure â”€â”€â–º Log error
      â”‚
      â”œâ”€â–º Network error?
      â”‚   â””â”€â–º Retry (max 3 times)
      â”‚
      â”œâ”€â–º Insufficient SOL?
      â”‚   â””â”€â–º Notify user, pause automation
      â”‚
      â”œâ”€â–º Position not found?
      â”‚   â””â”€â–º Skip, mark position as closed
      â”‚
      â””â”€â–º Unknown error?
          â””â”€â–º Log, notify, pause automation
```

---

## State Machine: Automation Status

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INACTIVEâ”‚  User disabled automation
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚ Enable
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ACTIVE  â”‚  Monitoring positions
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º Budget exceeded â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                        â”‚ BUDGET_LIMIT â”‚
     â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º Error (3+ failures) â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                            â”‚ ERROR_PAUSED â”‚
     â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â””â”€â–º User pause â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ PAUSED  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Integration Points

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Automation      â”‚
â”‚  Engine          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚ Meteora SDK  â”‚  Build transactions
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚ Wallet       â”‚  Sign transactions
         â”‚   â”‚ Adapter      â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   â”‚ Solana RPC   â”‚  Send & confirm
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â””â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ Supabase DB  â”‚  Store logs & config
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**This diagram shows the complete automation flow from user configuration to transaction execution! ğŸš€**

